<!doctype html>
<html lang="es" data-theme="finpro">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SGF — v 1.100_estable</title>

  <!-- Bootstrap (requerido por SGF_v1_00_00.js) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <style>
/* =======================
   SGF UI (Prototype look) + SGF v1_00_00 functionality
   - Layout inspirado en SGF_UI_Prototype_v1.html
   - Funcionalidad: SGF_v1_00_00.js
   ======================= */

/* Theme tokens (map: finpro/finsoft/darkledger) */
:root{
  --bg:#f6f7fb;--panel:#ffffff;--panel2:#fbfbfd;--text:#0f172a;--muted:#5b6475;--border:rgba(15,23,42,.10);
  --shadow:0 10px 28px rgba(2,6,23,.10);--shadow2:0 8px 18px rgba(2,6,23,.08);
  --brand:#2563eb;--brand2:#0ea5e9;--good:#16a34a;--warn:#f59e0b;--bad:#ef4444;
  --chip:rgba(37,99,235,.10);--chipText:#1d4ed8;--focus:rgba(37,99,235,.25);--stripe:rgba(2,6,23,.03);
  --radius:18px;--r2:14px;
  --font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";
}
html[data-theme="finpro"]{
  /* mismo que :root */
}
html[data-theme="finsoft"]{
  --bg:#fbfbfe;--panel:#ffffff;--panel2:#f6f7fb;
  --shadow:0 10px 26px rgba(2,6,23,.08);--shadow2:0 8px 16px rgba(2,6,23,.07);
  --chip:rgba(14,165,233,.10);--chipText:#0369a1;--focus:rgba(14,165,233,.20);
}
html[data-theme="darkledger"]{
  --bg:#0b1220;--panel:#0f172a;--panel2:#0c1426;--text:#ffffff;--muted:#a4aec3;--border:rgba(226,232,240,.12);
  --shadow:0 14px 40px rgba(0,0,0,.40);--shadow2:0 10px 26px rgba(0,0,0,.32);
  --brand:#60a5fa;--brand2:#22d3ee;--good:#34d399;--warn:#fbbf24;--bad:#fb7185;
  --chip:rgba(96,165,250,.15);--chipText:#93c5fd;--focus:rgba(96,165,250,.28);--stripe:rgba(255,255,255,.04);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:var(--font);
  color:var(--text);
  background:
    radial-gradient(1200px 500px at 18% 0%, rgba(37,99,235,.10), transparent 55%),
    radial-gradient(900px 450px at 80% 0%, rgba(14,165,233,.10), transparent 55%),
    var(--bg);
}

/* Layout (Prototype) */
.app{display:grid;grid-template-columns:292px 1fr;min-height:100vh}
.sidebar{
  position:sticky;top:0;height:100vh;overflow:auto;padding:16px 14px;
  background:linear-gradient(180deg, rgba(255,255,255,.75), transparent 75%), var(--panel2);
  border-right:1px solid var(--border)
}
html[data-theme="darkledger"] .sidebar{
  background:linear-gradient(180deg, rgba(15,23,42,.68), transparent 75%), var(--panel2);
}
.brand{display:flex;gap:10px;align-items:center;justify-content:center;padding:10px}
.logo{
  height:36px;min-width:36px;padding:0 12px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;
  font-weight:800;font-size:12px;letter-spacing:.2px;white-space:nowrap;
  box-shadow:var(--shadow2)
}

.logo i{font-size:18px;line-height:1;display:block}
html[data-theme="darkledger"] .logo{color:#fff}
.sub{font-size:12px;color:var(--muted);margin-top:2px}
.main{min-width:0;display:flex;flex-direction:column}

.topbar{
  position:sticky;top:0;z-index:5;
  background:linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,0)), var(--panel2);
  border-bottom:1px solid var(--border);
  padding:12px 16px;
}
html[data-theme="darkledger"] .topbar{
  background:linear-gradient(180deg, rgba(15,23,42,.68), rgba(15,23,42,0)), var(--panel2);
}
.toprow{display:flex;align-items:center;justify-content:space-between;gap:12px;max-width:1400px;margin:0 auto}
.hamb{
  display:none;
  width:44px;height:40px;border-radius:14px;border:1px solid var(--border);
  background:var(--panel);box-shadow:var(--shadow2);
}
.title h1{margin:0;font-size:18px}
.crumb{margin-top:2px;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

.content{padding:16px;max-width:1400px;margin:0 auto;width:100%}

/* Responsive: desktop sidebar + mobile offcanvas */
@media (max-width:991.98px){
  .app{grid-template-columns:1fr}
  .sidebar{display:none}
  .hamb{display:inline-flex;align-items:center;justify-content:center}
}

/* =======================
   Layout option: Sidebar vs Top menu
   - Default: sidebar (current)
   - layout-top: hide sidebar on desktop and show top horizontal nav
   ======================= */
.topnav{
  display:none;
  max-width:1400px;
  margin:10px auto 0;
  padding:0 0 6px;
}
.sgf-nav-top{
  flex-direction:row;
  gap:8px;
  padding:0;
  flex-wrap:nowrap;
  overflow:auto;
  scrollbar-width:thin;
}
.sgf-nav-top .nav-link{
  white-space:nowrap;
  padding:8px 12px !important;
  border-radius:999px;
}
.sgf-nav-top .nav-link i.bi{
  width:28px;height:28px;border-radius:999px;
}

/* Top menu MUST be horizontal (strong override) */
body.layout-top .sgf-nav-top{
  display:flex !important;
  flex-direction:row !important;
  align-items:center !important;
  flex-wrap:nowrap !important;
}
body.layout-top .sgf-nav-top > li,
body.layout-top .sgf-nav-top .nav-item{
  flex:0 0 auto !important;
}
body.layout-top .sgf-nav-top .nav-link{
  width:auto !important;
}
body.layout-top .app{grid-template-columns:1fr}
body.layout-top .sidebar{display:none}
body.layout-top .topnav{display:block}
@media (max-width:991.98px){
  body.layout-top .topnav{display:none}
}


/* =======================
   Bootstrap look -> Prototype look (scoped)
   ======================= */
.sgf-shell{
  --bs-body-color:var(--text);
  --bs-body-bg:transparent;
  --bs-border-color:var(--border);
  --bs-border-color-translucent:var(--border);
}

/* Cards */
.sgf-shell .card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:hidden;
}
.sgf-shell .card-header{
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg, rgba(37,99,235,.06), transparent);
}
html[data-theme="darkledger"] .sgf-shell .card-header{
  background:linear-gradient(180deg, rgba(96,165,250,.10), transparent);
}
.sgf-shell .card-body{padding:14px}
.sgf-shell .card .card-body.filters-bar{padding:14px}
.sgf-shell hr{border-color:var(--border)}

/* Buttons */
.sgf-shell .btn{
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  box-shadow:var(--shadow2);
  font-weight:800;
  transition:transform .04s;
}
.sgf-shell .btn:hover{transform:translateY(-1px)}
.sgf-shell .btn:active{transform:translateY(0)}
.sgf-shell .btn-dark,
.sgf-shell .btn-primary{
  background:linear-gradient(135deg,var(--brand),var(--brand2));
  border-color:transparent;
  color:#fff;
}
.sgf-shell .btn-outline-dark,
.sgf-shell .btn-outline-secondary,
.sgf-shell .btn-outline-primary,
.sgf-shell .btn-outline-success,
.sgf-shell .btn-outline-danger{
  background:var(--panel);
}
.sgf-shell .btn-outline-dark{color:var(--text)}
.sgf-shell .btn-outline-primary{color:var(--chipText);border-color:rgba(37,99,235,.24)}
.sgf-shell .btn-outline-success{color:var(--good);border-color:rgba(22,163,74,.28)}
.sgf-shell .btn-outline-danger{color:var(--bad);border-color:rgba(239,68,68,.28)}
.sgf-shell .btn-sm{padding:.42rem .62rem;border-radius:12px;font-weight:800}
.sgf-shell .btn-group .btn{box-shadow:none}
.sgf-shell .btn-close{filter:none}

/* Inputs */
.sgf-shell .form-control,
.sgf-shell .form-select,
.sgf-shell .input-group-text{
  border-radius:14px !important;
  border:1px solid var(--border) !important;
  background:var(--panel2) !important;
  color:var(--text) !important;
  box-shadow:none !important;
}
.sgf-shell .input-group > :not(:first-child){border-left:0 !important}
.sgf-shell .input-group-text{color:var(--muted)}
.sgf-shell .form-control:focus,
.sgf-shell .form-select:focus{
  box-shadow:0 0 0 6px var(--focus) !important;
  border-color:rgba(37,99,235,.35) !important;
}

/* Tables */
.sgf-shell .table{
  --bs-table-bg:transparent;
  color:var(--text);
  margin:0;
}
.sgf-shell .table-responsive{
  border-radius:var(--r2);
  border:1px solid var(--border);
}
.sgf-shell .table > :not(caption) > * > *{
  border-bottom:1px solid var(--border);
}
.sgf-shell .table thead th{
  position:sticky; top:0; z-index:1;
  background:var(--panel2);
  color:var(--muted);
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:.4px;
}
.sgf-shell .table-striped > tbody > tr:nth-of-type(odd) > *{
  background:var(--stripe);
}
.sgf-shell .progress{height:8px;border-radius:999px;background:rgba(2,6,23,.06)}
html[data-theme="darkledger"] .sgf-shell .progress{background:rgba(255,255,255,.08)}
.sgf-shell .progress-bar{background:linear-gradient(135deg,var(--brand),var(--brand2))}

/* Badges */
.badge-soft{
  font-size:12px;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  color:var(--muted);
  background:rgba(2,6,23,.03);
}
html[data-theme="darkledger"] .badge-soft{background:rgba(255,255,255,.06)}

/* Nav (generated by SGF buildNav) */
.sgf-nav{display:flex;flex-direction:column;gap:6px;padding:8px;margin:0;list-style:none}
.sgf-nav .nav-link{
  border-radius:14px;
  border:1px solid transparent;
  color:var(--muted);
  transition:background .2s,border-color .2s,color .2s;
}
.sgf-nav .nav-link:hover{
  background:rgba(37,99,235,.08);
  border-color:rgba(37,99,235,.16);
  color:var(--text);
}
.sgf-nav .nav-link.active{
  background:rgba(37,99,235,.12);
  border-color:rgba(37,99,235,.24);
  color:var(--text);
}
.sgf-nav .nav-link i.bi{
  width:30px;height:30px;border-radius:12px;
  display:inline-grid;place-items:center;
  border:1px solid var(--border);
  background:rgba(2,6,23,.06);
}
html[data-theme="darkledger"] .sgf-nav .nav-link i.bi{background:rgba(255,255,255,.06)}

/* KPI blocks (Dashboard) */
.kpi{
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow2);
  background:var(--panel);
  padding:14px;
}
.kpi-title{font-size:12px;color:var(--muted);font-weight:900;text-transform:uppercase;letter-spacing:.4px}
.kpi-value{font-size:26px;font-weight:900;margin-top:2px}
.kpi-sub{margin-top:6px;font-size:12px;color:var(--muted)}
.kpi-income{border-left:6px solid var(--good)}
.kpi-expense{border-left:6px solid var(--warn)}
.kpi-savings{border-left:6px solid var(--brand2)}
.kpi-neutral{border-left:6px solid var(--brand)}
.kpi-warn{border-left:6px solid var(--bad)}

/* Tree view */
.tree ul{padding-left:0;margin:0;list-style:none}
.tree li{margin:6px 0}
.tree .node{
  display:flex;align-items:center;gap:10px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid transparent;
  color:var(--muted);
}
.tree .node:hover{background:rgba(37,99,235,.08);border-color:rgba(37,99,235,.16);color:var(--text)}
.tree .node.sel{background:rgba(37,99,235,.12);border-color:rgba(37,99,235,.24);color:var(--text)}
.tree .caret{cursor:pointer;min-width:22px;display:inline-flex;justify-content:center}
.tree .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
.tree .name{font-weight:400;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:220px}
.tree .meta{margin-left:auto;display:flex;align-items:center}
.tree .actions{display:flex;gap:6px;margin-left:10px}
.tree ul.hide{display:none}
.tree ul ul{margin-left:22px;padding-left:20px;border-left:1px solid var(--border)}
.tree ul ul ul{margin-left:18px;padding-left:26px}

/* Links */
a.dash-link, a{color:inherit;text-decoration:none}
.sgf-link{color:inherit}
.sgf-link:hover{text-decoration:underline}
.rep-link{
  display:inline-flex;
  align-items:center;
  gap:.35rem;
  padding:.18rem .55rem;
  background:rgba(255,255,255,.85);
  border:1px solid rgba(15,23,42,.14);
  border-radius:999px;
  color:inherit;
  text-decoration:underline;
  font-weight:700;
  line-height:1.1;
  box-shadow:0 1px 2px rgba(15,23,42,.08);
}
.rep-link:hover{
  background:rgba(255,255,255,1);
  border-color:rgba(15,23,42,.22);
  text-decoration:underline;
  color:inherit;
}
.rep-link:focus{
  outline:none;
  box-shadow:0 0 0 .2rem rgba(37,99,235,.18);
}

a.dash-link:hover{text-decoration:underline}

/* Offcanvas & modals look */
.offcanvas{
  background:var(--panel2);
  color:var(--text);
  border-right:1px solid var(--border);
}

/* --- SGF Modals (match app design) --- */
.sgf-modal .modal-dialog{ --bs-modal-margin:1.25rem; }
.sgf-modal .modal-content{
  border-radius:22px;
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  background:var(--panel);
  color:var(--text);
  overflow:hidden;
}
.sgf-modal .modal-header{
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  padding:1rem 1.25rem;
}
.sgf-modal .modal-title{
  font-weight:800;
  letter-spacing:.2px;
}
.sgf-modal .modal-subtitle{
  margin-top:.15rem;
  font-size:.9rem;
  color:var(--muted);
}
.sgf-modal .modal-body{
  padding:1rem 1.25rem 1.25rem 1.25rem;
}
.sgf-modal .modal-footer{
  border-top:1px solid var(--border);
  background:color-mix(in srgb, var(--panel2) 88%, transparent);
  padding:.9rem 1.25rem;
  gap:.5rem;
}

/* Sticky footer for long forms */
.sgf-modal .modal-dialog-scrollable .modal-footer{
  position:sticky;
  bottom:0;
  z-index:5;
  backdrop-filter:saturate(1.2) blur(8px);
}


/* Modal button palette (match Prototype) */
.sgf-modal .btn{
  border-radius:14px;
  font-weight:700;
  letter-spacing:.15px;
}
.sgf-modal .btn.btn-dark{
  /* SGF JS usa btn-dark para acciones primarias en modales */
  background:linear-gradient(135deg,var(--brand),var(--brand2));
  border-color:transparent;
  color:#fff;
  box-shadow:0 10px 22px rgba(37,99,235,.18);
}
.sgf-modal .btn.btn-dark:hover{filter:brightness(1.03)}
.sgf-modal .btn.btn-dark:active{transform:translateY(1px)}
.sgf-modal .btn.btn-dark:focus{
  box-shadow:0 0 0 .25rem var(--focus), 0 10px 22px rgba(37,99,235,.18);
}

.sgf-modal .btn-outline-dark{
  /* Botones tipo Cerrar/Cancelar */
  color:var(--text);
  border-color:var(--border);
  background:transparent;
}
.sgf-modal .btn-outline-dark:hover{
  background:color-mix(in srgb, var(--chip) 65%, transparent);
  border-color:color-mix(in srgb, var(--brand) 35%, var(--border));
}
.sgf-modal .btn-outline-dark:focus{box-shadow:0 0 0 .25rem var(--focus)}

.sgf-modal .btn-danger{
  border-color:transparent;
  box-shadow:0 10px 22px rgba(239,68,68,.14);
}

/* Close button visibility on dark */
.theme-darkledger .sgf-modal .btn-close{
  filter:invert(1) grayscale(100%);
  opacity:.85;
}
.theme-darkledger .sgf-modal .btn-close:hover{ opacity:1; }

/* Normalize Bootstrap light/white utilities inside modals */
.theme-darkledger .sgf-modal .bg-white,
.theme-darkledger .sgf-modal .bg-light,
.theme-darkledger .sgf-modal .table-light,
.theme-darkledger .sgf-modal .text-bg-light{
  background-color:var(--panel2) !important;
  color:var(--text) !important;
}

/* Buttons: keep existing markup but theme them properly */
.theme-darkledger .btn-outline-dark{
  color:var(--text) !important;
  border-color:color-mix(in srgb, var(--border) 70%, transparent) !important;
}
.theme-darkledger .btn-outline-dark:hover{
  background:color-mix(in srgb, var(--panel2) 70%, transparent) !important;
}

/* Inputs inside modals */
.sgf-modal .form-control,
.sgf-modal .form-select{
  border-radius:14px;
}
.sgf-modal .input-group-text{
  border-radius:14px;
}

/* =======================
   Dark Ledger: force legibility (white text)
   ======================= */
html[data-theme="darkledger"]{
  --text:#ffffff;
}
html[data-theme="darkledger"] .text-dark{ color:#ffffff !important; }
html[data-theme="darkledger"] .text-secondary{ color:rgba(255,255,255,.85) !important; }
html[data-theme="darkledger"] .text-muted{ color:rgba(255,255,255,.70) !important; }

html[data-theme="darkledger"] .text-bg-light{
  background-color:rgba(255,255,255,.14) !important;
  color:#ffffff !important;
}
html[data-theme="darkledger"] .bg-light{
  background-color:rgba(255,255,255,.08) !important;
}

html[data-theme="darkledger"] ::placeholder{ color:rgba(255,255,255,.60) !important; }
html[data-theme="darkledger"] .btn-close{ filter:invert(1) grayscale(100%); }

/* Dark Ledger: tables & light rows (avoid white blocks) */
html[data-theme="darkledger"] .sgf-shell .table{
  --bs-table-color: var(--text) !important;
  --bs-table-border-color: rgba(255,255,255,.12) !important;
  --bs-table-striped-bg: rgba(255,255,255,.04) !important;
  --bs-table-striped-color: var(--text) !important;
  --bs-table-active-bg: rgba(255,255,255,.06) !important;
  --bs-table-active-color: var(--text) !important;
  --bs-table-hover-bg: rgba(255,255,255,.06) !important;
  --bs-table-hover-color: var(--text) !important;
}
/* Bootstrap helper backgrounds that are hard-coded to white */
html[data-theme="darkledger"] .bg-white,
html[data-theme="darkledger"] .bg-light{
  background-color: var(--panel2) !important;
  color: var(--text) !important;
}
/* Rows/cells marked as table-light (tfoot totals, pivot net rows, etc.) */
html[data-theme="darkledger"] .table-light{
  --bs-table-color: var(--text) !important;
  --bs-table-bg: rgba(255,255,255,.06) !important;
  --bs-table-border-color: rgba(255,255,255,.12) !important;
  color: var(--text) !important;
}
html[data-theme="darkledger"] .table-light > :not(caption) > * > *{
  background-color: rgba(255,255,255,.06) !important;
  color: var(--text) !important;
  border-color: rgba(255,255,255,.12) !important;
}
/* Ensure sticky headers stay dark even if JS adds bg-white */
html[data-theme="darkledger"] .table thead.bg-white,
html[data-theme="darkledger"] .table thead.bg-light{
  background-color: var(--panel2) !important;
}


/* ===== UI tweaks (unificar tipografía / evitar bold / tablas menos estrechas) ===== */
.sgf-shell, .sgf-shell *{ font-family: var(--font); }
.sgf-shell .fw-bold,
.sgf-shell .fw-semibold,
.sgf-shell strong,
.sgf-shell b{ font-weight:500 !important; } /* neutraliza excesos de bold */
.sgf-shell h1,.sgf-shell h2,.sgf-shell h3,.sgf-shell h4,.sgf-shell h5,.sgf-shell h6{ font-weight:600; }
.sgf-shell .sgf-nav .nav-link span{ font-weight:500; }
.sgf-shell label, .sgf-shell .form-label{ font-weight:500; }
.sgf-shell .table th{ font-weight:500; }
.sgf-shell .table td{ font-weight:400; }

/* tablas: más aire y menos “apretadas” */
.sgf-shell .table th,
.sgf-shell .table td{
  padding:.85rem 1rem;
  vertical-align:middle;
  min-width:130px;
}
.sgf-shell .table th:last-child,
.sgf-shell .table td:last-child{
  min-width:96px;
}
@media (max-width: 576px){
  .sgf-shell .table th,
  .sgf-shell .table td{ min-width:110px; }
}


/* === v3 tweaks: tablas más espaciosas + filtros colapsables === */
.table td, .table th{ padding:.8rem 1.15rem; }
.table thead th{ white-space:nowrap; }
.table td{ vertical-align:middle; }
.table-responsive{ overflow-x:auto; }
.table{ min-width: 1120px; }


/* === v8: Ajuste de tablas en Configuración (FX histórico / Auto-backups) === */
#v-settings .table{ min-width:0 !important; width:100% !important; }
#v-settings .table th, #v-settings .table td{ min-width:0 !important; white-space:normal; }
#v-settings .table thead th{ white-space:nowrap; } /* headers cortos */
#v-settings .table td{ word-break:break-word; }
#v-settings .table td:last-child, #v-settings .table th:last-child{ white-space:nowrap; } /* acciones */
#v-settings .table-responsive{ overflow-x:hidden; } /* evita scroll innecesario si cabe */
@media (max-width: 768px){
  #v-settings .table-responsive{ overflow-x:auto; } /* en móvil sí */
}


/* filtros collapsible */
.filters-bar{ position:relative; }
.filters-bar .btn.sgf-filters-toggle{ padding:.25rem .5rem; }
.filters-bar.sgf-filters-collapsed .sgf-filters-collapsible{ display:none !important; }


/* Actions column: keep buttons aligned in one row */
.table th:last-child, .table td:last-child{white-space:nowrap}
.table td:last-child{min-width:140
